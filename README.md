# Zhukovsky Site

Веб-приложение для управления турами на FastAPI с интерактивной картой.

## Требования

- Python 3.8+
- PostgreSQL
- pip для управления зависимостями

## Установка

### 1. Клонирование репозитория

```bash
git clone https://github.com/ArmPump/zhukovsky-site.git
cd zhukovsky-site
```

### 2. Создание виртуального окружения

```bash
python -m venv venv
```

### 3. Активация виртуального окружения

**Windows:**
```bash
venv\Scripts\activate
```

**Linux/MacOS:**
```bash
source venv/bin/activate
```

### 4. Установка зависимостей

```bash
pip install -r requirements.txt
```

## Настройка окружения

### 1. Конфигурация переменных окружения

Создайте или отредактируйте файл `.env` в директории `app/` с необходимыми переменными:

```env
DATABASE_URL=postgresql://user:password@localhost:5432/zhukovsky_db
SECRET_KEY=your-secret-key-here
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
```

### 2. Настройка базы данных

Убедитесь, что PostgreSQL запущен и создана база данных:

```sql
CREATE DATABASE zhukovsky_db;
```

### 3. Заполнение базовыми данными

Перед первым запуском необходимо заполнить базу данных начальными данными:

```bash
python seed_data.py
```

Эта команда создаст необходимые таблицы и заполнит базу тестовыми данными о турах.

## Запуск приложения

### Запуск backend-сервера

Для запуска приложения используйте файл `run.py`:

```bash
python run.py
```

После запуска приложение будет доступно по адресу:
- Основной URL: `http://localhost:8000`
- Документация API (Swagger): `http://localhost:8000/docs`
- Альтернативная документация (ReDoc): `http://localhost:8000/redoc`

### Альтернативный способ запуска

Если нужен запуск с автоматической перезагрузкой при изменениях кода:

```bash
uvicorn app.backend.main:app --reload --host 0.0.0.0 --port 8000
```

## Доступ к админ-панели

Для доступа к функциям администратора:

1. Откройте главную страницу сайта
2. Найдите окно авторизации
3. Введите данные администратора:
   - **Email**: `admin@zhukovsky.com`
   - **Пароль**: любой (пароли не проверяются на backend)
4. После входа в профиле появится плашка **"Админ-панель"**

### Возможности админ-панели

В админ-панели доступны следующие функции:

- **Создание новых туров** - добавление новых туристических направлений
- **Удаление туров** - удаление существующих туров

> **Важно**: Редактирование туров не реализовано. Для изменения информации о туре необходимо удалить старый тур и создать новый.

### Интерактивная карта

При создании нового тура:
- Тур **сразу отображается на карте** без перезагрузки страницы
- **Страны автоматически подсвечиваются** на карте в зависимости от добавленных направлений
- Удаление тура также обновляет карту в реальном времени

## Структура проекта

```
zhukovsky-site/
├── app/
│   ├── backend/         # Backend код (FastAPI)
│   ├── frontend/        # Frontend код (HTML/CSS/JS)
│   ├── .env            # Переменные окружения
│   └── __init__.py
├── seed_data.py        # Скрипт заполнения БД
├── run.py              # Скрипт запуска приложения
├── requirements.txt    # Python зависимости
├── .gitignore
└── README.md
```

## Основные зависимости

- **FastAPI** 0.122.0 - веб-фреймворк для backend
- **SQLAlchemy** 2.0.44 - ORM для работы с PostgreSQL
- **Uvicorn** 0.38.0 - ASGI-сервер
- **Pydantic** 2.12.4 - валидация данных
- **python-jose** 3.5.0 - работа с JWT токенами
- **bcrypt** 5.0.0 - хеширование паролей
- **psycopg2-binary** 2.9.11 - PostgreSQL драйвер

## Полезные команды

```bash
# Проверка установленных зависимостей
pip list

# Обновление зависимостей
pip install --upgrade -r requirements.txt

# Перезаполнение базы данных (удалит все данные и заполнит заново)
python seed_data.py

# Остановка сервера
Ctrl + C

# Деактивация виртуального окружения
deactivate
```

## Troubleshooting

### Ошибка подключения к базе данных
- Проверьте, что PostgreSQL запущен
- Убедитесь, что данные подключения в `.env` корректны
- Проверьте права доступа пользователя PostgreSQL
- Убедитесь, что база данных создана

### Ошибки импорта модулей
- Убедитесь, что виртуальное окружение активировано
- Переустановите зависимости: `pip install -r requirements.txt`
- Проверьте, что вы находитесь в корневой директории проекта

### Порт уже занят
- Остановите процесс, использующий порт 8000
- Или измените порт в файле `run.py`

### Пустая база данных
- Убедитесь, что вы запустили `python seed_data.py` перед первым запуском приложения
- Проверьте логи выполнения скрипта на наличие ошибок

## Краткий гайд по запуску

```bash
# 1. Клонирование и переход в папку
git clone https://github.com/ArmPump/zhukovsky-site.git
cd zhukovsky-site

# 2. Создание и активация venv
python -m venv venv
source venv/bin/activate  # Linux/Mac
venv\Scripts\activate     # Windows

# 3. Установка зависимостей
pip install -r requirements.txt

# 4. Настройка .env файла в app/
# Отредактируйте файл app/.env с данными вашей БД

# 5. Создание базы данных в PostgreSQL
# Выполните в psql: CREATE DATABASE zhukovsky_db;

# 6. Заполнение базы данными
python seed_data.py

# 7. Запуск приложения
python run.py

# 8. Откройте браузер по адресу http://localhost:8000
```

## Лицензия

MIT License

## Автор

ArmPump - [GitHub](https://github.com/ArmPump)